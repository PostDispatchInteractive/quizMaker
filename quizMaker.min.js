function escapeHtml(e){return String(e).replace(/[&<>"'\/]/g,function(e){return entityMap[e]})}var questions=[],quesNum=0,basePath="",byline="",sources="",stltoday=!0,cover=!1,debug=!1,entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};jQuery(document).ready(function(e){function s(s){e("#codeOutput").val(e("#codeOutput").val()+s)}function o(){this.quesType=!1,this.sound=!1,this.dissolve=!1,this.zoomIn=!1,this.zoomOut=!1,this.scroll=!1}function u(e){var s=e.val(),o=s.match(/\S+\s*/g),u=null!==o?o.length:0;return u}function i(){var s=u(e(this)),o="#080";s>34?o="#A00":s>28?o="#E60":s>24?o="#BA0":s>18&&(o="#7A0"),e(this).siblings(".wordCount").text(s).css("background-color",o)}function t(){var o=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:(?:[^\s()<>.]+[.]?)+|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,u=/^(\d\d\d\d)$/,i="Johnny Reporter",t="News service name, Website name";if(e("#mdsURL").val()||!stltoday||debug)if(u.test(e("#mdsURL").val())||!stltoday||debug)if(e("#otherURL").val()||stltoday||debug)if(o.test(e("#otherURL").val())||stltoday||debug)if(e("#byline").val()!==i||debug)if(e("#sources").val()!==t||debug)if(e("#coverImage").val()||!cover||debug)if(e("#coverText").val()||!cover||debug){e("#addButton").unbind(),byline=e("#byline").val(),sources=e("#sources").val();var a=e("#mdsURL").val();if(basePath=stltoday?"http://images.stltoday.com/mds/0000"+a+"/content/":e("#otherURL").val(),s('<div id="quiz">\r\n'),s('	<div class="spinningWheel"><span>The quiz is loading</span></div>\r\n'),cover){var l=e("#coverImage").val().split("\\").pop(),r=e("#coverText").val();s('	<div class="cover">\r\n'),s('		<img id="quizCover" src="'+basePath+l+'" />\r\n'),s("		<p>"+r+"</p>\r\n"),s("	</div>\r\n")}n()}else e("#coverPopup2").bPopup({onClose:function(){e("#coverText").focus()}});else e("#coverPopup1").bPopup({onClose:function(){e("#coverImage").focus()}});else e("#bylineSourcesPopup").bPopup({onClose:function(){e("#sources").focus()}});else e("#bylineSourcesPopup").bPopup({onClose:function(){e("#byline").focus()}});else e("#urlPopup3").bPopup({onClose:function(){e("#otherURL").focus()}});else e("#urlPopup3").bPopup({onClose:function(){e("#otherURL").focus()}});else e("#urlPopup2").bPopup({onClose:function(){e("#mdsURL").focus()}});else e("#urlPopup1").bPopup({onClose:function(){e("#mdsURL").focus()}})}function n(){e("#quizMaker form#credits").hide(),e("#quizMaker form#quiz fieldset#addMultiChoice").hide(),e("#quizMaker form#quiz fieldset#addTrueFalse").hide(),e("#quizMaker form#quiz fieldset#addMultiPhoto").hide(),e("#quizMaker form#quiz fieldset#quesEffects").hide(),e("#quizMaker form#quiz button").hide(),e("#quizMaker form#quiz").show(),e("#quizMaker form#quiz fieldset#quesType").show(),e("#labelCredits").removeClass("active"),e("#labelQuestions").addClass("active"),e("#quesType input").attr("checked",!1),e("#quesType input").click(function(){"multiple 2x2"===e(this).attr("value")?a():"multiple choice"===e(this).attr("value")?l():"true/false"===e(this).attr("value")&&r(),e("#addMoreButton").off("click"),e("#scoringButton").off("click"),e("#addMoreButton").click(function(){p("more")}),e("#scoringButton").click(function(){p("score")})})}function a(){questions[quesNum]=new o,questions[quesNum].quesType="multiple 2x2",e("#quizMaker form#quiz fieldset#addMultiChoice").hide(),e("#quizMaker form#quiz fieldset#addTrueFalse").hide(),e("#quizMaker form#quiz fieldset#addMultiPhoto").show(),e("#quizMaker form#quiz button").show(),e("#quizMaker form#quiz fieldset#quesEffects").show(),e("#quizMaker form#quiz fieldset#quesEffects ol").show(),e("#quizMaker form#quiz fieldset#quesEffects .dissolve").hide(),e("#quizMaker form#quiz fieldset#quesEffects .effectPicker").hide(),debug&&c(e("#quizMaker form#quiz fieldset#addMultiPhoto")),e("#addMultiPhoto textarea").unbind(),e("#addMultiPhoto textarea").keyup(i),e("#quesEffects input:checkbox").click(function(){e(this).is(":checked")?("effect-dissolve"===e(this).attr("value")&&d("dissolve"),"effect-sound"===e(this).attr("value")&&d("sound"),"effect-zoom"===e(this).attr("value")&&d("zoom")):("effect-dissolve"===e(this).attr("value")&&f("dissolve"),"effect-sound"===e(this).attr("value")&&f("sound"),"effect-zoom"===e(this).attr("value")&&f("zoom"))})}function l(){questions[quesNum]=new o,questions[quesNum].quesType="multiple choice",e("#quizMaker form#quiz fieldset#addTrueFalse").hide(),e("#quizMaker form#quiz fieldset#addMultiPhoto").hide(),e("#quizMaker form#quiz fieldset#addMultiChoice").show(),e("#quizMaker form#quiz button").show(),e("#quizMaker form#quiz fieldset#quesEffects").show(),e("#quizMaker form#quiz fieldset#quesEffects ol").show(),e("#quizMaker form#quiz fieldset#quesEffects .effectPicker").hide(),debug&&c(e("#quizMaker form#quiz fieldset#addMultiChoice")),e("#quesEffects input:checkbox").click(function(){e(this).is(":checked")?("effect-dissolve"===e(this).attr("value")&&d("dissolve"),"effect-sound"===e(this).attr("value")&&d("sound"),"effect-zoom"===e(this).attr("value")&&d("zoom")):("effect-dissolve"===e(this).attr("value")&&f("dissolve"),"effect-sound"===e(this).attr("value")&&f("sound"),"effect-zoom"===e(this).attr("value")&&f("zoom"))})}function r(){questions[quesNum]=new o,questions[quesNum].quesType="true/false",e("#quizMaker form#quiz fieldset#addMultiPhoto").hide(),e("#quizMaker form#quiz fieldset#addMultiChoice").hide(),e("#quizMaker form#quiz fieldset#addTrueFalse").show(),e("#quizMaker form#quiz button").show(),e("#quizMaker form#quiz fieldset#quesEffects").show(),e("#quizMaker form#quiz fieldset#quesEffects ol").show(),e("#quizMaker form#quiz fieldset#quesEffects .effectPicker").hide(),e("#customLabelsCheck").is(":checked")?(e(".tfLabels").hide(),e(".customLabels").show()):(e(".tfLabels").show(),e(".customLabels").hide()),debug&&c(e("#quizMaker form#quiz fieldset#addTrueFalse")),e("#customLabelsCheck").click(function(){e(this).is(":checked")?(e(".tfLabels").hide(),e(".customLabels").show()):(e(".customLabels").val(""),e(".tfLabels").show(),e(".customLabels").hide())}),e("#quesEffects input:checkbox").click(function(){e(this).is(":checked")?("effect-dissolve"===e(this).attr("value")&&d("dissolve"),"effect-sound"===e(this).attr("value")&&d("sound"),"effect-zoom"===e(this).attr("value")&&d("zoom")):("effect-dissolve"===e(this).attr("value")&&f("dissolve"),"effect-sound"===e(this).attr("value")&&f("sound"),"effect-zoom"===e(this).attr("value")&&f("zoom"))})}function c(s){var o=["To get to the other side","Because he wanted to","To save his chicks","He had a death wish"],u=["sean-connery.jpg","nick-nolte.jpg","richard-gere.jpg","mel-gibson.jpg"];if(s.find(".field-question").val("This is a dummy question. Why did the chicken cross the road?"),s.find(".field-response").val("This is a dummy response. Chickens are renowned for their delight in crossing roads."),s.find(".field-answer").each(function(s){e(this).val(o[s])}),"addMultiPhoto"==s.attr("id"))s.find(".field-photo").each(function(s){var o=e(this).attr("id");e(this).replaceWith('<input type="text" id="'+o+'" class="field-photo" value="'+u[s]+'" />')});else{var i=s.find(".field-photo").attr("id");s.find(".field-photo").replaceWith('<input type="text" id="'+i+'" class="field-photo" value="komodo.jpg" />')}s.find(".field-truefalse").attr("checked",!0)}function d(s){e("#quizMaker form#quiz fieldset#quesEffects ."+s+".effectPicker").show(),questions[quesNum][s]=!0}function f(s){e("#quizMaker form#quiz fieldset#quesEffects ."+s+".effectPicker").hide(),questions[quesNum][s]=!1}function p(s){if("multiple 2x2"===questions[quesNum].quesType)e("#mpAns0").val()?e("#mpAns1").val()?e("#mpAns2").val()?e("#mpAns3").val()?e("#mpPho0").val()?e("#mpPho1").val()?e("#mpPho2").val()?e("#mpPho3").val()?questions[quesNum].dissolve&&!e("#effectDissolvePhoto").val()?e("#effectPopup1").bPopup({onClose:function(){e("#effectDissolvePhoto").focus()}}):"more"===s?m():"score"===s&&g():e("#photoPopup1").bPopup({onClose:function(){e("#mpPho3").focus()}}):e("#photoPopup1").bPopup({onClose:function(){e("#mpPho2").focus()}}):e("#photoPopup1").bPopup({onClose:function(){e("#mpPho1").focus()}}):e("#photoPopup1").bPopup({onClose:function(){e("#mpPho0").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mpAns3").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mpAns2").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mpAns1").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mpAns0").focus()}});else if("multiple choice"===questions[quesNum].quesType)e("#mcAns0").val()?e("#mcAns1").val()?e("#mcAns2").val()?e("#mcAns3").val()?e("#mcPho0").val()?questions[quesNum].dissolve&&!e("#effectDissolvePhoto").val()?e("#effectPopup1").bPopup({onClose:function(){e("#effectDissolvePhoto").focus()}}):"more"===s?m():"score"===s&&g():e("#photoPopup2").bPopup({onClose:function(){e("#mcPho0").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mcAns3").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mcAns2").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mcAns1").focus()}}):e("#ansPopup1").bPopup({onClose:function(){e("#mcAns0").focus()}});else if("true/false"===questions[quesNum].quesType){var o=e("#true").is(":checked"),u=e("#false").is(":checked");o||u?e("#tfPho0").val()?"effect-dissolve"!==questions[quesNum].dissolve||e("#effectDissolvePhoto").val()?"more"===s?m():"score"===s&&g():e("#effectPopup1").bPopup({onClose:function(){e("#effectDissolvePhoto").focus()}}):e("#photoPopup2").bPopup({onClose:function(){e("#tfPho0").focus()}}):e("#ansPopup2").bPopup()}}function m(){e("#addMoreButton").off("click"),e("#scoringButton").off("click"),e("#quesEffects input:checkbox").off("click"),"multiple 2x2"===questions[quesNum].quesType?q():"multiple choice"===questions[quesNum].quesType?h():"true/false"===questions[quesNum].quesType&&v(),n()}function q(){var o=escapeHtml(e("#mpQuestion").val()),u=escapeHtml(e("#mpAns0").val()),i=escapeHtml(e("#mpAns1").val()),t=escapeHtml(e("#mpAns2").val()),n=escapeHtml(e("#mpAns3").val()),a=e("#mpPho0").val().split("\\").pop(),l=e("#mpPho1").val().split("\\").pop(),r=e("#mpPho2").val().split("\\").pop(),c=e("#mpPho3").val().split("\\").pop(),d=escapeHtml(e("#mpResponse").val()),f="",p="",m="";questions[quesNum].dissolve?(p=basePath+e("#effectDissolvePhoto").val().split("\\").pop(),f+=" effect-dissolve"):questions[quesNum].sound?(m=basePath+e("#effectSoundFile").val().split("\\").pop(),f+=" effect-sound"):questions[quesNum].zoomIn?f+=" effect-zoom-in":questions[quesNum].zoomOut&&(f+=" effect-zoom-out"),s('	<div class="questions multiphoto'+f+'" id="question'+quesNum+'">\r\n'),s('		<div class="photos">\r\n'),s('			<img id="ques'+quesNum+'pho0" class="correct" src="'+basePath+a+'" />\r\n'),s('			<img id="ques'+quesNum+'pho1" class="wrong" src="'+basePath+l+'" />\r\n'),s('			<img id="ques'+quesNum+'pho2" class="wrong" src="'+basePath+r+'" />\r\n'),s('			<img id="ques'+quesNum+'pho3" class="wrong" src="'+basePath+c+'" />\r\n'),s("		</div>\r\n"),questions[quesNum].sound&&(s('			<div class="sounds">\r\n'),s('				<audio class="after" preload="auto" src="'+m+'"></audio>\r\n'),s("		</div>\r\n")),s('		<div class="question">'+o+"</div>\r\n"),s('		<div class="answers">\r\n'),s('			<div class="answerLine"><input type="radio" class="correct" value="correct" id="ques'+quesNum+'ans0" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans0">'+u+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans1" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans1">'+i+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans2" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans2">'+t+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans3" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans3">'+n+"</label></div>\r\n"),s("		</div>\r\n"),s('		<div class="response"><span class="answeredWrong">Wrong.</span><span class="answeredCorrect">Right.</span> '+d+"</div>\r\n"),s("	</div>\r\n"),quesNum++,z("quesEffects"),z("addMultiPhoto")}function h(){var o=escapeHtml(e("#mcQuestion").val()),u=escapeHtml(e("#mcAns0").val()),i=escapeHtml(e("#mcAns1").val()),t=escapeHtml(e("#mcAns2").val()),n=escapeHtml(e("#mcAns3").val()),a=e("#mcPho0").val().split("\\").pop(),l=escapeHtml(e("#mcResponse").val()),r="",c="",d="";questions[quesNum].dissolve?(c=basePath+e("#effectDissolvePhoto").val().split("\\").pop(),r+=" effect-dissolve"):questions[quesNum].sound?(d=basePath+e("#effectSoundFile").val().split("\\").pop(),r+=" effect-sound"):questions[quesNum].zoomIn?r+=" effect-zoom-in":questions[quesNum].zoomOut&&(r+=" effect-zoom-out"),s('	<div class="questions multichoice'+r+'" id="question'+quesNum+'">\r\n'),s('		<div class="photos">\r\n'),questions[quesNum].dissolve&&s('			<img class="layer" src="'+c+'" />\r\n'),s('			<img id="ques'+quesNum+'pho0" class="layer correct" src="'+basePath+a+'" />\r\n'),s("		</div>\r\n"),questions[quesNum].sound&&(s('			<div class="sounds">\r\n'),s('				<audio class="after" preload="auto" src="'+d+'"></audio>\r\n'),s("		</div>\r\n")),s('		<div class="question">'+o+"</div>\r\n"),s('		<div class="answers">\r\n'),s('			<div class="answerLine"><input type="radio" class="correct" value="correct" id="ques'+quesNum+'ans0" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans0">'+u+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans1" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans1">'+i+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans2" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans2">'+t+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="wrong" value="wrong" id="ques'+quesNum+'ans3" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans3">'+n+"</label></div>\r\n"),s("		</div>\r\n"),s('		<div class="response"><span class="answeredWrong">Wrong.</span><span class="answeredCorrect">Right.</span> '+l+"</div>\r\n"),s("	</div>\r\n"),quesNum++,z("quesEffects"),z("addMultiChoice")}function v(){var o=escapeHtml(e("#tfQuestion").val()),u=e('#addTrueFalse input[name="trueFalse"]:checked').val(),i=escapeHtml(e("#trueLabel").val()),t=escapeHtml(e("#falseLabel").val());if(""==i||null==i)var n="True";else var n=i;if(""==t||null==t)var a="False";else var a=t;var l=e("#tfPho0").val().split("\\").pop(),r=e("#tfResponse").val();if("true"===u)var c="correct",d="wrong";else var c="wrong",d="correct";var f="",p="",m="";questions[quesNum].dissolve?(p=basePath+e("#effectDissolvePhoto").val().split("\\").pop(),f+=" effect-dissolve"):questions[quesNum].sound?(m=basePath+e("#effectSoundFile").val().split("\\").pop(),f+=" effect-sound"):questions[quesNum].zoomIn?f+=" effect-zoom-in":questions[quesNum].zoomOut&&(f+=" effect-zoom-out"),s('	<div class="questions truefalse'+f+'" id="question'+quesNum+'">\r\n'),s('		<div class="photos">\r\n'),questions[quesNum].dissolve&&s('			<img class="layer" src="'+p+'" />\r\n'),s('			<img id="ques'+quesNum+'pho0" class="layer correct" src="'+basePath+l+'" />\r\n'),s("		</div>\r\n"),questions[quesNum].sound&&(s('			<div class="sounds">\r\n'),s('				<audio class="after" preload="auto" src="'+m+'"></audio>\r\n'),s("		</div>\r\n")),s('		<div class="question">'+o+"</div>\r\n"),s('		<div class="answers">\r\n'),s('			<div class="answerLine"><input type="radio" class="'+c+'" value="'+c+'" id="ques'+quesNum+'ans0" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans0">'+n+"</label></div>\r\n"),s('			<div class="answerLine"><input type="radio" class="'+d+'" value="'+d+'" id="ques'+quesNum+'ans1" name="ques'+quesNum+'" /><label for="ques'+quesNum+'ans1">'+a+"</label></div>\r\n"),s("		</div>\r\n"),s('		<div class="response"><span class="answeredWrong">Wrong.</span><span class="answeredCorrect">Right.</span> '+r+"</div>\r\n"),s("	</div>\r\n"),quesNum++,z("quesEffects"),z("addTrueFalse")}function g(){e("#labelQuestions").removeClass("active"),e("#labelScoring").addClass("active"),e("#addMoreButton").unbind(),e("#scoringButton").unbind(),e("#quesEffects input:checkbox").unbind(),"multiple 2x2"===questions[quesNum].quesType?q():"multiple choice"===questions[quesNum].quesType?h():"true/false"===questions[quesNum].quesType&&v(),e("#quiz").hide(),e("#assignScoring").show(),e("<p>Your quiz has "+quesNum+" questions.</p>").insertBefore("#scoringLabels"),quesNum>5&&(scoringRangeLow=Math.round(.1*quesNum),scoringRangeMedian=Math.round(.5*quesNum),scoringRangeHigh=Math.round(.9*quesNum),scoringRangeHigh>=quesNum&&(scoringRangeHigh=quesNum-1),1>scoringRangeLow&&(scoringRangeLow=1),e("#scoringRange0").val(scoringRangeHigh),e("#scoringRange1").val(Math.round(.7*quesNum)),e("#scoringRange2").val(scoringRangeMedian),e("#scoringRange3").val(Math.round(.3*quesNum)),e("#scoringRange4").val(scoringRangeLow)),e("#finish").click(b)}function b(){e("#labelScoring").removeClass("active"),e("#finish").unbind(),e("#finish").hide();var o=e("#judgment").val().split("\\").pop(),u=e("#scoringResponse").val();s('	<div id="scoring">\r\n'),s('		<div class="photos"><img id="judgment" src="'+basePath+o+'" /></div>\r\n'),s('		<div id="response">'+u+"</div>\r\n"),s("	</div>\r\n"),s("</div>\r\r\n"),s('<div id="credits"><strong>QUIZ BY:</strong> '+byline+"</div>\r\n"),s('<div id="sources"><strong>SOURCES:</strong> '+sources+"</div>\r\r\n"),s('<script type="text/javascript">\r\n'),s("	var totalQuestions = "+quesNum+";\r\n"),s("	var scoringRange = [];\r\n"),s("	var scoringEvaluation = [];\r\n"),e(".scoringRange").each(function(o){thisRange=e(this).val(),s("	scoringRange["+o+"] = "+thisRange+";\r\n")}),e(".evaluation").each(function(o){thisEvaluation=escapeHtml(e(this).val()),s("	scoringEvaluation["+o+'] = "'+thisEvaluation+'";\r\n')}),s("</script>\r\r\n"),s('<script type="text/javascript" src="http://images.stltoday.com/mds/00003409/content/quizReader.js"></script>\r\r\n'),s('<link rel="stylesheet" type="text/css" href="http://images.stltoday.com/mds/00003409/content/style.css" />\r\n'),e("#assignScoring").hide(),e("#codeOutput").show(),e("<p>Please select all the code above, copy it, and paste it into a new Blox HTML asset. Then you are done!</p>").insertAfter("#codeOutput")}function z(s){e(":input","#"+s).not(":button, :submit, :reset, :hidden, :checkbox, #true, #false, #trueLabel, #falseLabel").val(""),e("#true").attr("checked",!1),e("#false").attr("checked",!1),e("#"+s+' input[type="checkbox"]').not("#customLabelsCheck").attr("checked",!1)}e.getScript("http://images.stltoday.com/mds/00003409/content/jquery.bpopup-0.5.0.min.js"),e("#codeOutput").hide(),e("#quizMaker form#quiz fieldset").hide(),e("#quizMaker form").hide(),e("#quizMaker form#quiz button").hide(),e("#quizMaker form li.otherURL").hide(),e("#quizMaker form .photonote-other").hide(),e("#quizMaker form .coverFields").hide(),e("#quizMaker form#credits").show(),e("#quizMaker form").submit(function(){return!1}),e("#labelCredits").addClass("active"),debug&&e("#mdsURL").val("3766"),e("#addButton").click(t),e("#pubs").click(function(){e(this).is(":checked")?(stltoday=!0,e("#quizMaker form li.otherURL").hide(),e("#quizMaker form .photonote-other").hide(),e("#quizMaker form li.mdsURL").show(),e("#quizMaker form .photonote-stltoday").show()):(stltoday=!1,e("#quizMaker form li.mdsURL").hide(),e("#quizMaker form .photonote-stltoday").hide(),e("#quizMaker form li.otherURL").show(),e("#quizMaker form .photonote-other").show())}),e("#cover").click(function(){e(this).is(":checked")?(cover=!0,e("#quizMaker form .coverFields").show()):(cover=!1,e("#quizMaker form .coverFields").hide())})});